<div xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxd="http://nuxeo.org/nxweb/document">

  <c:if test="false">
    Reminder: Do not put comment directely in xhtml or you are gonna have trouble.
    Use c:if test="false" to add comment in xhtml code.
  </c:if>

  <c:if test="false">
  Could be loaded in a theme, etc. Easier here.
  </c:if>
  <script src="#{contextPath}/scripts/jquery.Jcrop.js" />
  <script src="#{contextPath}/scripts/nuxeo-skyscanner-image-cropper.js" />
  <LINK href="#{contextPath}/css/nuxeo-skyscanner-image-cropper.css" rel="stylesheet" type="text/css" />
  <LINK href="#{contextPath}/css/jquery.Jcrop.css" rel="stylesheet" type="text/css" />

  <h3>
   <h:outputText value="#{currentDocument.title}"/>
  </h3>
  
  <c:set var="imageWidth" value="#{skyscannerImageCropHelper.getImageWidth()}" />
  <c:set var="imageHeight" value="#{skyscannerImageCropHelper.getImageHeight()}" />
  <c:set var="originalImageWidth" value="#{skyscannerImageCropHelper.getOriginalImageWidth()}" />
  <c:set var="originalImageHeight" value="#{skyscannerImageCropHelper.getOriginalImageHeight()}" />

  <div id="#{fancyboxFormId}">
    <div>
      <div id="#{fancyboxFormId}_buttons" class="buttonsGadget">
        <button id="#{fancyboxFormId}_cropInCroppedPictures" onclick="SkyscannerCrop.cropInCroppedPictures();" class="skyscannercrop_button" title="Save the result of the crop in 'Cropped Pictures'" style="margin-left: 5px">Crop</button>
        <span style="width:50px"></span>
        <span><i>Original image width: #{skyscannerImageCropHelper.getOriginalImageWidth()}, height: #{skyscannerImageCropHelper.getOriginalImageHeight()}</i></span>
        <div id="#{fancyboxFormId}_cropCoords" style="font-size:smaller; padding-top: 5px; margin-left: 5px">
          <div style="display:inline-block;width:120px;"><label class="skyscannercrop_cropfieldlabel">Local (this picture)</label></div>
          <label class="skyscannercrop_cropfieldlabel">X1 <input type="number" min="0" max="#{imageWidth}" size="4" id="#{fancyboxFormId}_cropX1" readonly="true" name="x1" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Y1 <input type="number" min="0" max="#{imageHeight}" size="4" id="#{fancyboxFormId}_cropX2" readonly="true" name="y1" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">X2 <input type="number" min="0" max="#{imageWidth}" size="4" id="#{fancyboxFormId}_cropY1" readonly="true" name="x2" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Y2 <input type="number" min="0" max="#{imageHeight}" size="4" id="#{fancyboxFormId}_cropY2" readonly="true" name="y2" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Width <input type="number" min="1" max="#{imageWidth}" size="4" id="#{fancyboxFormId}_cropW" readonly="true" name="w" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Height <input type="number" min="1" max="#{imageHeight}" size="4" id="#{fancyboxFormId}_cropH" readonly="true" name="h" class="skyscannercrop_cropfield" /></label>
        </div>
        <div id="#{fancyboxFormId}_cropCoordsOriginal" style="font-size:smaller; padding-top: 5px; margin-left: 5px">
         <div style="display:inline-block;width:120px;"><label class="skyscannercrop_cropfieldlabel">In original picture</label></div>
          <label class="skyscannercrop_cropfieldlabel">X1 <input type="number" min="0" max="originalImageWidth" size="4" id="#{fancyboxFormId}_originalX1" readonly="true" name="origx1" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Y1 <input type="number" min="0" max="originalImageHeight" size="4" id="#{fancyboxFormId}_originalX2" readonly="true" name="origy1" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">X2 <input type="number" min="0" max="originalImageWidth" size="4" id="#{fancyboxFormId}_originalY1" readonly="true" name="origx2" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Y2 <input type="number" min="0" max="originalImageHeight" size="4" id="#{fancyboxFormId}_originalY2" readonly="true" name="origy2" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Width <input type="number" min="0" max="originalImageWidth" size="4" id="#{fancyboxFormId}_originalW" readonly="true" name="origw" class="skyscannercrop_cropfield" /></label>
          <label class="skyscannercrop_cropfieldlabel">Height <input type="number" min="0" max="originalImageHeight" size="4" id="#{fancyboxFormId}_originalH" readonly="true" name="origh" class="skyscannercrop_cropfield" /></label>
        </div>
      </div>
      <p></p>
      <div id="#{fancyboxFormId}_divImg" style="padding:5px; width: #{skyscannerImageCropHelper.getImageBoxWidth()}px; height: #{skyscannerImageCropHelper.getImageBoxHeight()}px;">        
        <img id="#{fancyboxFormId}_img" src="#{skyscannerImageCropHelper.getImageViewURL(false)}" style="display:block; margin-left: auto; margin-right:auto" width="#{imageWidth}px" height="#{imageHeight}px" />
      </div>
    </div>
    <script type="text/javascript" charset="utf-8">
    	var imageProps = {
    			cropWidth: #{imageWidth},
    			cropHeight: #{imageHeight},
    			cropUrl: "#{skyscannerImageCropHelper.getImageViewURL(false)}",
    			originalWidth: #{originalImageWidth},
    			originalHeight: #{originalImageHeight},
    			originalUrl: "#{skyscannerImageCropHelper.getImageViewURL(true)}",
    			scaleH: #{skyscannerImageCropHelper.getScaleH()},
    			scaleV: #{skyscannerImageCropHelper.getScaleV()}
    	};
        SkyscannerCrop.init("#{fancyboxFormId}", "#{currentDocument.id}", imageProps);
    </script>
  </div>

</div>
